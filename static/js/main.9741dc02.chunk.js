(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{198:function(e,t,n){},199:function(e,t,n){},200:function(e,t,n){},201:function(e,t,n){},202:function(e,t,n){},203:function(e,t,n){},204:function(e,t,n){},205:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(77),i=n.n(o),c=n(208),s=n(24);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var l,u,m=n(3),h=n(4),g=n(6),f=n(5),d=n(7),p=r.a.createContext({thingList:[],error:null,setError:function(){},clearError:function(){},setThingList:function(){}}),v=p,E=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(g.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).state={thingList:[],error:null},n.setThingList=function(e){n.setState({thingList:e})},n.setError=function(e){console.error(e),n.setState({error:e})},n.clearError=function(){n.setState({error:null})},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e={thingList:this.state.thingList,error:this.state.error,setError:this.setError,clearError:this.clearError,setThingList:this.setThingList};return r.a.createElement(p.Provider,{value:e},this.props.children)}}]),t}(a.Component),b=n(81),j={author:{},tags:[]},w=r.a.createContext({thing:j,reviews:[],error:null,setError:function(){},clearError:function(){},setThing:function(){},clearThing:function(){},setReviews:function(){},addReview:function(){}}),T=w,k=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(g.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).state={thing:j,error:null},n.setError=function(e){console.error(e),n.setState({error:e})},n.clearError=function(){n.setState({error:null})},n.setThing=function(e){n.setState({thing:e})},n.setReviews=function(e){n.setState({reviews:e})},n.clearThing=function(){n.setThing(j),n.setReviews([])},n.addReview=function(e){n.setReviews([].concat(Object(b.a)(n.state.reviews),[e]))},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e={thing:this.state.thing,reviews:this.state.reviews,error:this.state.error,setError:this.setError,clearError:this.clearError,setThing:this.setThing,setReviews:this.setReviews,clearThing:this.clearThing,addReview:this.addReview};return r.a.createElement(w.Provider,{value:e},this.props.children)}}]),t}(a.Component),y=n(210),_=n(209),O=n(206),N=n(17),R=n(78),S=n.n(R),L="https://blooming-castle-19115.herokuapp.com/api",x="my-own-special-jwt-secret",A={saveAuthToken:function(e){window.sessionStorage.setItem(x,e)},getAuthToken:function(){return window.sessionStorage.getItem(x)},clearAuthToken:function(){console.info("clearing the auth token"),window.sessionStorage.removeItem(x)},hasAuthToken:function(){return!!A.getAuthToken()},makeBasicAuthToken:function(e,t){return window.btoa("".concat(e,":").concat(t))},parseJwt:function(e){return S()(e)},readJwtToken:function(){return A.parseJwt(A.getAuthToken())},_getMsUntilExpiry:function(e){return 1e3*e.exp-Date.now()},queueCallbackBeforeExpiry:function(e){var t=A._getMsUntilExpiry(A.readJwtToken());l=setTimeout(e,t-1e4)},clearCallbackBeforeExpiry:function(){clearTimeout(l)}},P=A,I=null,F=["mousedown","mousemove","keypress","scroll","touchstart"],C={setIdleCallback:function(e){I=e},resetIdleTimer:function(e){console.info("event:",e.type),clearTimeout(u),u=setTimeout(I,3e5)},regiserIdleTimerResets:function(){F.forEach(function(e){return document.addEventListener(e,C.resetIdleTimer,!0)})},unRegisterIdleResets:function(){clearTimeout(u),F.forEach(function(e){return document.removeEventListener(e,C.resetIdleTimer,!0)})}},B=C,q=(n(94),function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(g.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).handleLogoutClick=function(){P.clearAuthToken(),P.clearCallbackBeforeExpiry(),B.unRegisterIdleResets()},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"renderLogoutLink",value:function(){return r.a.createElement("div",{className:"Header__logged-in"},r.a.createElement(O.a,{onClick:this.handleLogoutClick,to:"/"},"Logout"))}},{key:"renderLoginLink",value:function(){return r.a.createElement("div",{className:"Header__not-logged-in"},r.a.createElement(O.a,{to:"/login"},"Log in"),r.a.createElement(O.a,{to:"/register"},"Register"))}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("nav",{className:"Header"},r.a.createElement("h1",null,r.a.createElement(O.a,{to:"/"},r.a.createElement(N.a,{className:"blue",icon:"gift"})," Thingful")),r.a.createElement("span",{className:"Header__tagline--wide"},"Rate all the things."),P.hasAuthToken()?this.renderLogoutLink():this.renderLoginLink()),r.a.createElement("span",{className:"Header__tagline--narrow"},"Rate all the things."))}}]),t}(a.Component)),J=n(11),D=n(207);function U(e){var t=e.component,n=Object(J.a)(e,["component"]),a=t;return r.a.createElement(_.a,Object.assign({},n,{render:function(e){return P.hasAuthToken()?r.a.createElement(a,e):r.a.createElement(D.a,{to:{pathname:"/login",state:{from:e.location}}})}}))}function H(e){var t=e.component,n=Object(J.a)(e,["component"]),a=t;return r.a.createElement(_.a,Object.assign({},n,{render:function(e){return P.hasAuthToken()?r.a.createElement(D.a,{to:"/"}):r.a.createElement(a,e)}}))}var z={getThings:function(){return fetch("".concat(L,"/things"),{headers:{}}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})},getThing:function(e){var t=P.getAuthToken();return fetch("".concat(L,"/things/").concat(e),{headers:{Authorization:"Bearer ".concat(t)}}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})},getThingReviews:function(e){var t=P.getAuthToken();return fetch("".concat(L,"/things/").concat(e,"/reviews"),{headers:{Authorization:"Bearer ".concat(t)}}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})},postReview:function(e,t,n){var a=P.getAuthToken();return fetch("".concat(L,"/reviews"),{method:"POST",headers:{Authorization:"Bearer ".concat(a),"content-type":"application/json"},body:JSON.stringify({thing_id:e,rating:n,text:t})}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})}};n(79),n(198);function M(){return r.a.createElement("span",{className:"Hyph"}," - ")}function W(e){var t=e.className,n=Object(J.a)(e,["className"]);return r.a.createElement("button",Object.assign({className:["Button",t].join(" ")},n))}function $(e){var t=e.className,n=Object(J.a)(e,["className"]);return r.a.createElement("textarea",Object.assign({className:["Textarea",t].join(" ")},n))}function G(e){var t=e.className,n=Object(J.a)(e,["className"]);return r.a.createElement("input",Object.assign({className:["Input",t].join(" ")},n))}function K(e){var t=e.className,n=Object(J.a)(e,["className"]);return r.a.createElement("span",Object.assign({className:["Required",t].join(" ")},n),"*")}function Q(e){var t=e.className,n=e.list,a=Object(J.a)(e,["className","list"]),o=["Section",n&&"Section--list",t].filter(Boolean).join(" ");return r.a.createElement("section",Object.assign({className:o},a))}function V(e){for(var t=e.rating,n=[{filled:!1},{filled:!1},{filled:!1},{filled:!1},{filled:!1}],a=0;a<t;a++)n[a].filled=!0;return r.a.createElement("span",{className:"ThingStarRating"},n.map(function(e,t){return r.a.createElement(X,{key:t,filled:e.filled})}))}function X(e){var t=e.filled?"fas":"far";return r.a.createElement(N.a,{className:"blue",icon:[t,"star"]})}n(199);var Y=function(e){function t(){return Object(m.a)(this,t),Object(g.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props.thing;return r.a.createElement(O.a,{to:"/thing/".concat(e.id),className:"ThingListItem"},r.a.createElement("div",{className:"ThingListItem__image",style:{backgroundImage:"url(".concat(e.image,")")}}),r.a.createElement("div",{className:"ThingListItem__details"},r.a.createElement("div",{className:"ThingListItem__text"},r.a.createElement("h2",{className:"ThingListItem__heading"},e.title),r.a.createElement("p",{className:"ThingListItem__description"},function(e){var t=e.split(" ");if(t.length>10)return t.slice(0,10).join(" ")+" ...";return e}(e.content))),r.a.createElement("div",{className:"ThingListItem__reviews"},r.a.createElement(V,{rating:e.average_review_rating}),r.a.createElement("span",{id:"ThingListItem__review-count"},function(e){switch(e){case 0:return"no reviews yet";case 1:return"based on 1 review";default:return"based on ".concat(e," reviews")}}(e.number_of_reviews)))))}}]),t}(a.Component);n(200);var Z=function(e){function t(){return Object(m.a)(this,t),Object(g.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.context.clearError(),z.getThings().then(this.context.setThingList).catch(this.context.setError)}},{key:"renderThings",value:function(){var e=this.context.thingList;return(void 0===e?[]:e).map(function(e){return r.a.createElement(Y,{key:e.id,thing:e})})}},{key:"render",value:function(){var e=this.context.error;return r.a.createElement(Q,{list:!0,className:"ThingListPage"},e?r.a.createElement("p",{className:"red"},"There was an error, try again"):this.renderThings())}}]),t}(a.Component);Z.contextType=v;n(201);var ee=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(g.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).handleSubmit=function(e){e.preventDefault();var t=n.context.thing,a=e.target,r=a.text,o=a.rating;z.postReview(t.id,r.value,Number(o.value)).then(n.context.addReview).then(function(){r.value=""}).catch(n.context.setError)},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return r.a.createElement("form",{className:"ReviewForm",onSubmit:this.handleSubmit},r.a.createElement("div",{className:"text"},r.a.createElement($,{required:!0,"aria-label":"Type a review...",name:"text",id:"text",cols:"30",rows:"3",placeholder:"Type a review.."})),r.a.createElement("div",{className:"select"},r.a.createElement("label",{htmlFor:"rating"},"Rate this thing!"),r.a.createElement("select",{required:!0,"aria-label":"Rate this thing!",name:"rating",id:"rating"},r.a.createElement("option",{value:"1"},"1 Star"),r.a.createElement("option",{value:"2"},"2 Stars"),r.a.createElement("option",{value:"3"},"3 Stars"),r.a.createElement("option",{value:"4"},"4 Stars"),r.a.createElement("option",{value:"5"},"5 Stars"))),r.a.createElement(W,{type:"submit"},"Post review"))}}]),t}(a.Component);ee.contextType=T;n(202);var te=function(e){function t(){return Object(m.a)(this,t),Object(g.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.match.params.thingId;this.context.clearError(),z.getThing(e).then(this.context.setThing).catch(this.context.setError),z.getThingReviews(e).then(this.context.setReviews).catch(this.context.setError)}},{key:"componentWillUnmount",value:function(){this.context.clearThing()}},{key:"renderThing",value:function(){var e=this.context,t=e.thing,n=e.reviews;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"ThingPage__image",style:{backgroundImage:"url(".concat(t.image,")")}}),r.a.createElement("h2",null,t.title),r.a.createElement(ne,{thing:t}),r.a.createElement(ae,{reviews:n}),r.a.createElement(ee,null))}},{key:"render",value:function(){var e,t=this.context,n=t.error,a=t.thing;return e=n?"Thing doesn't exist"===n.error?r.a.createElement("p",{className:"red"},"Thing not found"):r.a.createElement("p",{className:"red"},"There was an error"):a.id?this.renderThing():r.a.createElement("div",{className:"loading"}),r.a.createElement(Q,{className:"ThingPage"},e)}}]),t}(a.Component);function ne(e){var t=e.thing;return r.a.createElement("p",{className:"ThingPage__content"},t.content)}function ae(e){var t=e.reviews,n=void 0===t?[]:t;return r.a.createElement("ul",{className:"ThingPage__review-list"},n.map(function(e){return r.a.createElement("li",{key:e.id,className:"ThingPage__review"},r.a.createElement("p",{className:"ThingPage__review-text"},r.a.createElement(N.a,{size:"lg",icon:"quote-left",className:"ThingPage__review-icon blue"}),e.text),r.a.createElement("p",{className:"ThingPage__review-user"},r.a.createElement(V,{rating:e.rating}),r.a.createElement(M,null),e.user.full_name))}))}te.defaultProps={match:{params:{}}},te.contextType=T;var re={postUser:function(e){return fetch("".concat(L,"/users"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})},postLogin:function(e){return fetch("".concat(L,"/auth/login"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})}).then(function(e){return P.saveAuthToken(e.authToken),B.regiserIdleTimerResets(),P.queueCallbackBeforeExpiry(function(){re.postRefreshToken()}),e})},postRefreshToken:function(){return fetch("".concat(L,"/auth/refresh"),{method:"POST",headers:{authorization:"Bearer ".concat(P.getAuthToken())}}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})}).then(function(e){return P.saveAuthToken(e.authToken),P.queueCallbackBeforeExpiry(function(){re.postRefreshToken()}),e}).catch(function(e){console.log("refresh token request error"),console.error(e)})}},oe=re,ie=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(g.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).handleSubmitJwtAuth=function(e){e.preventDefault(),n.setState({error:null});var t=e.target,a=t.user_name,r=t.password;oe.postLogin({user_name:a.value,password:r.value}).then(function(e){a.value="",r.value="",P.saveAuthToken(e.authToken),n.props.onLoginSuccess()}).catch(function(e){n.setState({error:e.error})})},n.state={error:null},n.handleSubmitBasicAuth=function(e){e.preventDefault();var t=e.target,a=t.user_name,r=t.password;console.log("login form submitted"),console.log(a.value,r.value);var o=window.btoa("".concat(a.value,":").concat(r.value));P.saveAuthToken(o),a.value="",r.value="",n.props.onLoginSuccess()},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.state.error;return r.a.createElement("form",{className:"LoginForm",onSubmit:this.handleSubmitJwtAuth},r.a.createElement("div",{role:"alert"},e&&r.a.createElement("p",{className:"red"},e)),r.a.createElement("div",{className:"user_name"},r.a.createElement("label",{htmlFor:"LoginForm__user_name"},"User name"),r.a.createElement(G,{required:!0,name:"user_name",id:"LoginForm__user_name"})),r.a.createElement("div",{className:"password"},r.a.createElement("label",{htmlFor:"LoginForm__password"},"Password"),r.a.createElement(G,{required:!0,name:"password",type:"password",id:"LoginForm__password"})),r.a.createElement(W,{type:"submit"},"Login"))}}]),t}(a.Component);ie.defaultProps={onLoginSuccess:function(){}};var ce=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(g.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).handleLoginSuccess=function(){var e=n.props,t=e.location,a=e.history,r=(t.state||{}).from||"/";a.push(r)},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return r.a.createElement(Q,{className:"LoginPage"},r.a.createElement("h2",null,"Login"),r.a.createElement(ie,{onLoginSuccess:this.handleLoginSuccess}))}}]),t}(a.Component);ce.defaultProps={location:{},history:{push:function(){}}};var se=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(g.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).state={error:null},n.handleSubmit=function(e){e.preventDefault();var t=e.target,a=t.full_name,r=t.nick_name,o=t.user_name,i=t.password;n.setState({error:null}),oe.postUser({user_name:o.value,password:i.value,full_name:a.value,nickname:r.value}).then(function(e){a.value="",r.value="",o.value="",i.value="",n.props.onRegistrationSuccess()}).catch(function(e){n.setState({error:e.error})})},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.state.error;return r.a.createElement("form",{className:"RegistrationForm",onSubmit:this.handleSubmit},r.a.createElement("div",{role:"alert"},e&&r.a.createElement("p",{className:"red"},e)),r.a.createElement("div",{className:"full_name"},r.a.createElement("label",{htmlFor:"RegistrationForm__full_name"},"Full name ",r.a.createElement(K,null)),r.a.createElement(G,{name:"full_name",type:"text",required:!0,id:"RegistrationForm__full_name"})),r.a.createElement("div",{className:"user_name"},r.a.createElement("label",{htmlFor:"RegistrationForm__user_name"},"User name ",r.a.createElement(K,null)),r.a.createElement(G,{name:"user_name",type:"text",required:!0,id:"RegistrationForm__user_name"})),r.a.createElement("div",{className:"password"},r.a.createElement("label",{htmlFor:"RegistrationForm__password"},"Password ",r.a.createElement(K,null)),r.a.createElement(G,{name:"password",type:"password",required:!0,id:"RegistrationForm__password"})),r.a.createElement("div",{className:"nick_name"},r.a.createElement("label",{htmlFor:"RegistrationForm__nick_name"},"Nickname"),r.a.createElement(G,{name:"nick_name",type:"text",required:!0,id:"RegistrationForm__nick_name"})),r.a.createElement(W,{type:"submit"},"Register"))}}]),t}(a.Component);se.defaultProps={onRegistrationSuccess:function(){}};var le=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(g.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).handleRegistrationSuccess=function(e){n.props.history.push("/login")},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return r.a.createElement(Q,{className:"RegistrationPage"},r.a.createElement("h2",null,"Register"),r.a.createElement(se,{onRegistrationSuccess:this.handleRegistrationSuccess}))}}]),t}(a.Component);le.defaultProps={history:{push:function(){}}};var ue=function(e){function t(){return Object(m.a)(this,t),Object(g.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return r.a.createElement(Q,{className:"NotFoundPage"},r.a.createElement("h2",null,"404 - Page not found"),r.a.createElement("p",null,"Try going back to your previous page."))}}]),t}(a.Component),me=(n(203),function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(g.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).state={hasError:!1},n.logoutFromIdle=function(){P.clearAuthToken(),P.clearCallbackBeforeExpiry(),B.unRegisterIdleResets(),n.forceUpdate()},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){B.setIdleCallback(this.logoutFromIdle),P.hasAuthToken()&&(B.regiserIdleTimerResets(),P.queueCallbackBeforeExpiry(function(){oe.postRefreshToken()}))}},{key:"componentWillUnmount",value:function(){B.unRegisterIdleResets(),P.clearCallbackBeforeExpiry()}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App__header"},r.a.createElement(q,null)),r.a.createElement("main",{className:"App__main"},this.state.hasError&&r.a.createElement("p",{className:"red"},"There was an error! Oh no!"),r.a.createElement(y.a,null,r.a.createElement(_.a,{exact:!0,path:"/",component:Z}),r.a.createElement(H,{path:"/login",component:ce}),r.a.createElement(H,{path:"/register",component:le}),r.a.createElement(U,{path:"/thing/:thingId",component:te}),r.a.createElement(_.a,{component:ue}))))}}],[{key:"getDerivedStateFromError",value:function(e){return console.error(e),{hasError:!0}}}]),t}(a.Component)),he=(n(204),n(80)),ge=n(12);s.b.add(ge.c,ge.f,ge.e,ge.d,ge.g,ge.a,ge.b,ge.h,he.a,ge.i),i.a.render(r.a.createElement(c.a,{basename:"/bob-hunter-thingful-jwt"},r.a.createElement(E,null,r.a.createElement(k,null,r.a.createElement(me,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},82:function(e,t,n){e.exports=n(205)},94:function(e,t,n){}},[[82,1,2]]]);
//# sourceMappingURL=main.9741dc02.chunk.js.map